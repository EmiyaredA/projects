from jinja2 import Template
from dataclasses import dataclass, field

generate_outline_system = Template("""
## 任务大纲
- 你的任务是接受用户提供的配置信息生成一个PPT大纲。配置信息将在后续给出。

## 注意事项
- 请确保每个幻灯片的主题清晰且结构合理。
- 生成的ppt大纲中的标题至少要有三级。
- 输出请以mermaid代码的格式给出。
- 输出的第二级标题数量控制在6个以内。
                                   
## 输入输出样例
**样例 1**  
**输入：**  
主题: "人工智能发展趋势", 内容: "介绍人工智能的最新研究进展", 语言: "中文", 幻灯片数量: 10  
**输出：**  
```mermaid
graph TD
    A[健康饮食与营养] --> B[健康饮食的基本原则]
    A --> C[主要营养素的作用]
    A --> D[健康饮食的误区]
    A --> E[合理饮食搭配]
    A --> F[常见的饮食错误与纠正]
    A --> G[总结与建议]

    B --> B1[控制热量摄入]
    B --> B2[均衡各类营养素]
    
    C --> C1[蛋白质的作用]
    C --> C2[脂肪的作用]
    C --> C3[碳水化合物的作用]
    
    D --> D1[减肥误区]
    D --> D2[节食不当的危害]
```

**样例 2**  
**输入：**  
主题: "健康饮食与营养", 内容: "如何保持健康的饮食习惯", 语言: "中文", 幻灯片数量: 8  
**输出：**  
```mermaid
graph TD
    A[企业战略规划] --> B[战略规划的定义与重要性]
    A --> C[市场分析与竞争态势]
    A --> D[SWOT分析方法]
    A --> E[确定企业愿景与使命]
    A --> F[长期发展目标设定]
    A --> G[总结与启示]

    B --> B1[战略规划的理论基础]
    B --> B2[战略规划的实施步骤]
    
    C --> C1[市场需求分析]
    C --> C2[竞争对手分析]
    
    D --> D1[SWOT分析的应用]
    D --> D2[PEST分析的运用]
    
    E --> E1[短期目标设定]
    E --> E2[长期目标设定]
```

**样例 3**  
**输入：**  
主题: "企业战略规划", 内容: "制定长期发展战略的关键要素", 语言: "中文", 幻灯片数量: 12  
**输出：**  
```mermaid
graph TD
    A[企业战略规划] --> B[战略规划的定义与重要性]
    A --> C[市场分析与竞争态势]
    A --> D[SWOT分析方法]
    A --> E[确定企业愿景与使命]
    A --> F[长期发展目标设定]
    A --> G[总结与启示]

    B --> B1[战略规划的理论基础]
    B --> B2[战略规划的实施步骤]
    
    C --> C1[市场需求分析]
    C --> C2[竞争对手分析]
    
    D --> D1[SWOT分析的应用]
    D --> D2[PEST分析的运用]
    
    E --> E1[短期目标设定]
    E --> E2[长期目标设定]
```
""".strip())

generate_outline_user = Template("""
主题: "{{topic}}",
内容: "{{content}}", 
语言: "{{language}}", 
幻灯片数量: {{slide_count}}
""".strip())

generate_ppt_page = Template("""
## 任务大纲
你需要根据输入的标题链生成几个标题内容对，标题内容对的数量为{{pairs_count}}。生成的标题内容对需要简洁且符合在PPT页面展示的要求，避免过长文字。输入是一个列表结构的标题链，代表PPT大纲路径，当前生成的PPT页面是该路径的叶节点。  

## 生成规则
1. 每个标题内容对的标题不超过{{title_limit}}字，内容不超过{{content_limit}}字。  
2. 保证标题与内容逻辑相关，内容清晰易懂。  
3. 输出以格式呈现，方便进一步处理。  

## 输入输出案例  
{{example_str}}

## 注意事项
1. 如果标题链较短，可以合理补充背景信息使内容完整。  
2. 生成的标题内容对需要直观反映PPT页的重点信息，并尽量易于理解和阅读。  
3. 确保生成的结果适合直接用于PPT页面展示，无需额外修改。
""".strip())

@dataclass
class PPTPageConfig:
    pairs_count: int = field(default=1)
    title_limit: int = field(default=20)
    content_limit: int = field(default=50)
    example_str: str = field(default="")

generate_ppt_page_examples = {
    1: """**输入：**  
["项目计划", "阶段一", "市场调研"]

**输出：**  
```html
<h1>市场调研计划</h1>
<p>市场调研旨在明确目标客户群体，并深入分析市场需求与竞争格局，为后续产品设计与营销策略提供依据。调研方法包括问卷调查、深度访谈和公开数据分析，确保获取多维度的信息支持。调研预计在1月10日至1月25日完成，共分为三个阶段：第一阶段聚焦客户需求，第二阶段分析市场趋势，第三阶段总结并形成完整的市场分析报告。各阶段均会安排不同的团队负责具体执行，确保调研结果的准确性与可操作性。最终成果将用于产品定位与商业计划的制定。</p>
```""".strip(),
    2: """**输入：**  
["项目计划", "市场调研"]

**输出：**  
```html
<h1>市场调研目标</h1>
<p>明确目标客户群体，分析市场需求与竞争格局，为项目规划提供数据支持，确保产品符合市场预期。</p>
<h1>调研方法</h1>
<p>采用问卷调查、深度访谈、数据分析等方法，通过多渠道获取市场信息，为阶段性目标提供支撑。</p>
```""".strip(),
    3: """**输入：**  
["项目计划", "市场调研"]

**输出：**  
```html
<h1>市场调研目标</h1> 
<p>明确目标客户群体，通过分析市场需求、消费者行为和竞争格局，为产品定位提供依据。根据不同的市场细分，设计有针对性的调研方案，收集详细的消费者反馈，以确保产品满足目标市场的需求。</p> 
<h1>调研方法</h1> 
<p>采用问卷调查、深度访谈、在线数据分析等多种方式，确保全面、客观地收集市场信息，充分了解目标客户的需求和偏好。通过分析调研数据，为后续的产品设计和优化提供依据。</p> 
<h1>时间安排</h1> 
<p>调研时间从1月10日至1月25日，分为三个阶段：准备阶段、执行阶段和数据分析阶段。每个阶段明确任务，确保调研按时完成，为后续工作提供支持。</p>
```""".strip(),
    4: """**输入：**  
["项目计划", "阶段一", "市场调研"]

**输出：**  
```html
<h1>调研目标</h1>
<p>明确目标客户群体，分析市场需求和竞争格局，确保为产品开发提供有力的市场支持。通过对行业现状、消费者需求和竞争对手的研究，找出潜在的市场机会，帮助制定后续的产品策略。</p>
<h1>调研方法</h1>
<p>采用问卷调查、深度访谈和数据分析等多种方法，收集消费者反馈、市场趋势及竞争格局等信息。结合定性和定量数据，确保调研结果具有广泛代表性和深度洞察。</p>
<h1>时间安排</h1>
<p>调研周期定于2025年1月10日至1月25日，分为三个阶段。第一阶段为准备和设计调研工具，第二阶段进行数据收集，第三阶段进行分析整理并撰写报告。</p>
<h1>总结报告</h1>
<p>完成市场分析报告，总结调研结果，评估市场机会，为后续的产品开发提供依据。报告将包括市场趋势分析、竞争态势评估以及用户需求预测，帮助决策者做出明智选择。</p>
```""".strip(),
    5: """**输入：**  
["项目计划", "阶段一", "市场调研"]

**输出：**  
```html
<h1>调研目标</h1>
<p>明确目标客户群体，深入分析市场需求及竞争格局，为产品开发提供数据支持。通过调研发现潜在市场机会，确保产品满足客户需求，并在市场中占有一席之地，推动公司业务增长。</p>
<h1>调研方法</h1>
<p>采用问卷调查、深度访谈及数据分析等多种方法，全面收集市场信息，确保调研结果的准确性与代表性。通过量化数据与定性分析结合，为后续决策提供可靠依据。</p>
<h1>时间安排</h1>
<p>调研周期为2025年1月10日至1月25日，分为三个阶段进行：准备阶段包括设计调研工具，数据收集阶段进行问卷调查和访谈，最后通过分析与总结阶段整理调研报告。</p>
<h1>阶段总结</h1>
<p>完成阶段性总结，分析调研结果，梳理市场趋势、客户需求及竞争态势，为后续的产品开发与市场策略提供决策依据。总结报告将帮助团队明确市场定位。</p>
<h1>报告输出</h1>
<p>整理调研数据并撰写市场分析报告，报告内容包括市场趋势、消费者需求、竞争分析及市场机会等，为公司决策层提供准确的市场洞察，帮助制定产品战略及营销方案。</p>
```""".strip(),
    6: """**输入：**  
["项目计划", "阶段一", "市场调研"]

**输出：**  
```html
<h1>调研目标</h1>
<p>明确目标客户群体，深入分析市场需求和竞争格局，为产品开发提供支持。通过调研了解市场机会，帮助团队识别潜在的风险与挑战，并制定相应的应对策略。</p>
<h1>调研方法</h1>
<p>通过问卷调查、深度访谈和数据分析等方式，全面收集市场和客户信息。结合定性与定量数据，确保结果的准确性和广泛代表性，为后续决策提供有力依据。</p>
<h1>时间安排</h1>
<p>调研周期从2025年1月10日至1月25日，分为准备、数据收集和分析报告三阶段进行。各阶段按计划推进，确保数据的全面性和调研的顺利进行。</p>
<h1>阶段总结</h1>
<p>总结阶段性成果，分析市场趋势、竞争态势和用户需求，为产品开发和市场推广提供科学依据。通过报告总结调研经验，确保后续工作顺利进行。</p>
<h1>报告输出</h1>
<p>撰写详细的市场调研报告，提供市场趋势、消费者需求、竞争分析等方面的深度洞察。报告将作为产品决策的依据，支持公司制定相应的市场策略。</p>
<h1>后续行动</h1>
<p>根据调研报告制定详细的产品策略，调整市场定位并优化产品设计。后续行动将紧密围绕调研结果，推动产品的市场推广与用户接受度提升。</p>
```""".strip(),
    8: """**输入：**  
["项目计划", "阶段一", "市场调研"]

**输出：**  
```html
<h1>调研目标</h1>
<p>明确目标客户群体，分析市场需求和竞争态势，为产品开发提供支持。通过调研帮助识别潜在的市场机会和挑战，制定有针对性的产品策略。</p>
<h1>调研方法</h1>
<p>采用问卷调查、深度访谈和数据分析等方式，全面收集市场和客户信息。通过多种手段确保调研结果的准确性，为后续决策提供科学依据。</p>
<h1>时间安排</h1>
<p>调研周期从2025年1月10日至1月25日，分为三个阶段进行。每个阶段明确目标，确保调研的顺利推进，并按时完成数据收集和报告编写。</p>
<h1>调研范围</h1>
<p>调研内容包括目标市场的消费者需求、竞争态势以及行业发展趋势等方面。通过深入分析，帮助明确市场定位和潜在机会。</p>
<h1>数据分析</h1>
<p>整理并分析收集到的数据，提炼出市场洞察。通过定量和定性分析，得出有效结论，为后续产品决策提供支持。</p>
<h1>报告编写</h1>
<p>撰写详细的市场调研报告，内容包括市场趋势、消费者需求、竞争分析等，为公司决策层提供全面的市场洞察，支持产品战略制定。</p>
<h1>阶段总结</h1>
<p>总结调研成果，分析市场机会，评估调研数据的可靠性，为产品开发和市场推广策略提供有力支持，帮助团队明确发展方向。</p>
<h1>后续行动</h1>
<p>根据调研报告制定详细的产品战略，优化市场推广计划。后续将根据实际情况调整策略，并推进产品的市场落地。</p>
```""".strip(),
}

ppt_page_configs = {
    1: PPTPageConfig(pairs_count=1, title_limit=20, content_limit=200, example_str=generate_ppt_page_examples[1]),
    2: PPTPageConfig(pairs_count=2, title_limit=15, content_limit=150, example_str=generate_ppt_page_examples[2]),
    3: PPTPageConfig(pairs_count=3, title_limit=12, content_limit=120, example_str=generate_ppt_page_examples[3]),
    4: PPTPageConfig(pairs_count=4, title_limit=10, content_limit=100, example_str=generate_ppt_page_examples[4]),
    5: PPTPageConfig(pairs_count=5, title_limit=10, content_limit=80, example_str=generate_ppt_page_examples[5]),
    6: PPTPageConfig(pairs_count=6, title_limit=10, content_limit=60, example_str=generate_ppt_page_examples[6]),
    8: PPTPageConfig(pairs_count=8, title_limit=6, content_limit=50, example_str=generate_ppt_page_examples[8])
}

def generate_ppt_page_prompt(pairs_count):
    ppt_page_config = ppt_page_configs[pairs_count]
    return generate_ppt_page.render(
        pairs_count=pairs_count,
        title_limit=ppt_page_config.title_limit,
        content_limit=ppt_page_config.content_limit,
        example_str=ppt_page_config.example_str
    )